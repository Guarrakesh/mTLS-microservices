version: "3"

services:

  # Appelli Microservice
  appelli_spring:
    build:
      args:
        DATA_DIR: ${DATA_DIR}
      context: appelli_microservice/spring
    container_name: "${PROJECT_NAME}_appelli_spring"
    env_file:
      - appelli_microservice/spring.env
    ports:
      - 8080:8080
    volumes:
      - "./appelli_microservice/spring/${DATA_DIR}:${CONTAINER_DIR}/${DATA_DIR}"
    networks:
      - esami_network

#  pds_db:
#    image: wodby/mariadb:$MARIADB_TAG
#    container_name: "${PROJECT_NAME}_pds_db"
#    env_file:
#      - pds_microservice/db.env
#    environment:
#      MYSQL_TMP_TABLE_SIZE: 16M
#      MYSQL_MAX_ALLOWED_PACKET: 256M
#      MYSQL_WAIT_TIMEOUT: 1200
#      MYSQL_INNODB_LOCK_WAIT_TIMEOUT: 600
#      MYSQL_INNODB_BUFFER_POOL_SIZE: 256M


  # Prenotazioni Microservice
  prenotazioni_spring:
    build:
      args:
        DATA_DIR: ${DATA_DIR}
      context: prenotazioni_microservice/spring
    container_name: "${PROJECT_NAME}_prenotazioni_spring"
    ports:
      - 8081:8080
    env_file:
      - prenotazioni_microservice/spring.env
    volumes:
      - "./prenotazioni_microservice/spring/${DATA_DIR}:${CONTAINER_DIR}/${DATA_DIR}"
    links:
      - "appelli_spring:appelli"
      - "lemur-web:lemur"
    networks:
      - esami_network

#  prenotazioni_db:
#    image: wodby/mariadb:$MARIADB_TAG
#    container_name: "${PROJECT_NAME}_prenotazioni_db"
#    env_file:
#      - prenotazioni_microservice/db.env
#
#    environment:
#      MYSQL_TMP_TABLE_SIZE: 16M
#      MYSQL_MAX_ALLOWED_PACKET: 256M
#      MYSQL_WAIT_TIMEOUT: 1200
#      MYSQL_INNODB_LOCK_WAIT_TIMEOUT: 600
#      MYSQL_INNODB_BUFFER_POOL_SIZE: 256M

networks:
  esami_network:
    driver: bridge
    external: false